/**********************************************************
 * Script to generate Array.sol file contains helpers to 
 * create dynamic arrays of variable sizes for solidity
 * base types.
 **********************************************************/

import fs from 'fs';

const HEADER = `
// AUTOGENERATED FILE (bin/gen-array-helpers.ts) DON'T MODIFY DIRECTLY
// SPDX-License-Identifier: GPL-3.0-or-later
pragma solidity <0.9.0;
`

const TARGETS = {
  uints: {
    type: "uint256"
  },
  addresses: {
    type: 'address'
  },
  bytes4s: {
    type: 'bytes4'
  },
  bytes32s: {
    type: 'bytes32'
  }
} as const;
const MAX_SIZE = 8;

let fileContent = HEADER;
for (const [fn, config] of Object.entries(TARGETS)) {
  const { type } = config;
  for (let i = 1; i <= MAX_SIZE; i++) {
    let args = "";
    let assignments = "";
    for (let j = 0; j < i; j++) {
      args += `  ${type} e${j}${j < i - 1 ? ',\n' : ''}`
      assignments += `  arr[${j}] = e${j};\n`
    }

    fileContent += `
function ${fn}(
${args}
) pure returns (${type}[] memory arr) {
  arr = new ${type}[](${i});
${assignments}
  return arr;
}
`
  }
  fileContent += `
function contains(${type}[] memory self, ${type} value) pure returns (bool) {
    for (uint256 i = 0; i < self.length; i++) {
        if (self[i] == value) {
            return true;
        }
    }
    return false;
}
`
}

fs.writeFileSync("src/Array.sol", fileContent);

